<!DOCTYPE html>
<html>
<head>
  <title>Image and Text Combination</title>
</head>
<body>
  <h1>Image and Text Combination</h1>

  <form id="imageForm">
    <label for="imageUpload1">Upload Image 1:</label>
    <input type="file" id="imageUpload1" accept="image/*"><br><br>

    <label for="imageUpload2">Upload Image 2:</label>
    <input type="file" id="imageUpload2" accept="image/*"><br><br>

    <label for="textField1">Text Field 1:</label>
    <input type="text" id="textField1"><br><br>

    <label for="textField2">Text Field 2:</label>
    <textarea id="textField2" rows="4"></textarea><br><br>

    <label for="imageUpload3">Upload Image 3:</label>
    <input type="file" id="imageUpload3" accept="image/*"><br><br>

    <button type="button" onclick="combineImageAndText()">Combine and Download</button>
  </form>

  <br><br>

  <div id="result"></div>

  <script>
    function combineImageAndText() {
      var imageUpload1 = document.getElementById("imageUpload1");
      var imageUpload2 = document.getElementById("imageUpload2");
      var imageUpload3 = document.getElementById("imageUpload3");
      var textField1 = document.getElementById("textField1").value;
      var textField2 = document.getElementById("textField2").value;
      var resultDiv = document.getElementById("result");

      if (imageUpload1.files && imageUpload1.files[0] && imageUpload2.files && imageUpload2.files[0] && imageUpload3.files && imageUpload3.files[0]) {
        var reader1 = new FileReader();
        var reader2 = new FileReader();
        var reader3 = new FileReader();

        reader1.onload = function(e1) {
          reader2.onload = function(e2) {
            reader3.onload = function(e3) {
              var image1 = new Image();
              image1.onload = function() {
                var image2 = new Image();
                image2.onload = function() {
                  var image3 = new Image();
                  image3.onload = function() {
                    // Calculate the aspect ratio of the resulting image
                    var maxImageWidth = 1280;
                    var maxImageHeight = 1600;
                    var aspectRatio = Math.min(maxImageWidth / image1.width, maxImageHeight / (image1.height + image2.height + 150 + 30 * textField2.split("\n").length));

                    var canvas = document.createElement("canvas");
                    canvas.width = maxImageWidth;
                    canvas.height = maxImageHeight;

                    var ctx = canvas.getContext("2d");
                    ctx.fillStyle = "white"; // Set white background color
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    var offsetY = 0;

                    ctx.drawImage(image1, 0, offsetY, image1.width * aspectRatio, image1.height * aspectRatio);
                    offsetY += image1.height * aspectRatio;

                    ctx.drawImage(image2, 0, offsetY, image2.width * aspectRatio, image2.height * aspectRatio);
                    offsetY += image2.height * aspectRatio;

                    ctx.font = "bold 30px Arial"; // Apply bold font style to textField1
                    ctx.fillStyle = "black";
                    ctx.fillText(textField1, 10, offsetY + 50);
                    offsetY += 100;

                    var lines = textField2.split("\n");
                    ctx.font = "30px Arial"; // Reset font style for textField2
                    for (var i = 0; i < lines.length; i++) {
                      ctx.fillText(lines[i], 10, offsetY + (i * 30));
                    }

                    offsetY += 30 * lines.length;

                    ctx.drawImage(image3, 0, offsetY + 50, image3.width * aspectRatio, image3.height * aspectRatio);

                    var combinedImage = canvas.toDataURL("image/png");

                    var link = document.createElement("a");
                    link.href = combinedImage;
                    link.download = "combined_image.png";
                    link.innerHTML = "<img src='" + combinedImage + "' alt='Combined Image'>";
                    resultDiv.appendChild(link);
                  };

                  image3.src = e3.target.result;
                };

                image2.src = e2.target.result;
              };

              image1.src = e1.target.result;
            };

            reader3.readAsDataURL(imageUpload3.files[0]);
          };

          reader2.readAsDataURL(imageUpload2.files[0]);
        };

        reader1.readAsDataURL(imageUpload1.files[0]);
      } else {
        resultDiv.innerHTML = "Please upload all three images and fill in the text fields.";
      }
    }
  </script>
</body>
</html>
